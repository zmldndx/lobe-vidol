# 虚拟人调试面板使用说明

## 概述

虚拟人调试面板是一个功能强大的调试工具，用于在Camera模式下监控和调试虚拟人控制系统的运行状态。面板可以显示render_stream信息记录，支持收缩展开和滚动查看。

## 功能特性

### 🎯 核心功能

1. **实时监控** - 实时显示AI回复生成的render_stream记录
2. **收缩展开** - 支持面板的收缩和展开，节省屏幕空间
3. **滚动查看** - 支持历史记录的滚动查看
4. **多标签页** - 提供流记录、统计、设置三个标签页

### 📊 显示信息

每个render_stream记录包含以下信息：

- **序号** - 记录的顺序编号
- **时间戳** - 记录生成的时间
- **文本内容** - AI回复的文本
- **表情** - 虚拟人的表情状态
- **动作** - 虚拟人的动作列表
- **相机模式** - 当前的相机控制模式
- **场景** - 当前的场景设置
- **背景** - 当前的背景设置
- **音频** - 音频数据的预览
- **流ID** - 唯一的流标识符

## 使用方法

### 1. 基本操作

#### 显示/隐藏面板
- 点击右上角的眼睛图标可以显示或隐藏调试面板

#### 展开/收缩面板
- 点击右上角的虫子图标可以展开或收缩面板
- 收缩状态下显示简要信息
- 展开状态下显示详细信息

#### 清空记录
- 在展开状态下，点击"清空"按钮可以清空所有记录

### 2. 标签页功能

#### 流记录标签页
- 显示所有render_stream记录的详细列表
- 按时间顺序排列，最新的记录在底部
- 支持滚动查看历史记录
- 自动滚动到最新记录

#### 统计标签页
- **基本统计** - 显示总记录数、当前状态、处理状态
- **表情统计** - 显示各种表情的使用次数和占比
- **动作统计** - 显示各种动作的使用次数和占比
- **相机统计** - 显示各种相机模式的使用次数和占比

#### 设置标签页
- **控制器状态** - 显示虚拟人控制器的连接状态
- **当前状态** - 显示控制器的当前运行状态
- **处理状态** - 显示是否正在处理AI回复
- **操作按钮** - 提供刷新页面和清空记录功能

### 3. 颜色编码

#### 表情颜色
- 🟢 **绿色** - happy, smile (开心)
- 🔴 **红色** - angry (愤怒)
- 🔵 **蓝色** - sad, cry (悲伤)
- 🟠 **橙色** - surprised (惊讶)
- 🟣 **紫色** - fear (恐惧)
- 🟤 **棕色** - disgust (厌恶)
- ⚪ **默认** - neutral (中性)

#### 动作颜色
- 🔵 **蓝色** - wave (挥手)
- 🟣 **紫色** - dance (跳舞)
- 🔴 **红色** - fist (握拳)
- 🟠 **橙色** - point (指向)
- ⚫ **灰色** - head_down, sigh (低头, 叹息)
- 🟤 **棕色** - turn_away, cover_nose (转身, 捂鼻子)

#### 相机模式颜色
- 🔵 **蓝色** - 智能镜头
- 🟣 **紫色** - 跟踪-大脸
- 🟠 **橙色** - 跟踪-背向
- 🟢 **绿色** - 跟踪-朝向
- ⚪ **默认** - 空

## 技术特性

### 性能优化

1. **自动滚动** - 新记录自动滚动到底部
2. **虚拟滚动** - 大量记录时使用虚拟滚动优化性能
3. **状态缓存** - 缓存控制器状态，避免频繁更新
4. **内存管理** - 限制历史记录数量，防止内存泄漏

### 响应式设计

1. **自适应布局** - 根据屏幕大小调整面板大小
2. **平滑动画** - 展开收缩使用平滑的CSS动画
3. **触摸友好** - 支持触摸设备的操作

### 调试功能

1. **实时监控** - 实时显示控制器状态
2. **错误处理** - 显示错误信息和处理状态
3. **性能统计** - 统计各种操作的使用频率
4. **状态追踪** - 追踪状态变化历史

## 配置选项

### 面板位置
```tsx
// 默认位置：右上角
position: 'fixed',
top: 20,
right: 20,
zIndex: 1000
```

### 面板大小
```tsx
// 收缩状态
width: 200px,
maxHeight: 100px

// 展开状态
width: 450px,
maxHeight: 700px
```

### 记录限制
```tsx
// 默认限制50条记录
maxHistory: 50
```

## 故障排除

### 常见问题

1. **面板不显示**
   - 检查虚拟人控制器是否已初始化
   - 确认viewer实例是否可用

2. **记录不更新**
   - 检查AI回复是否正常生成
   - 确认虚拟人控制系统是否正常工作

3. **性能问题**
   - 减少历史记录数量
   - 关闭不必要的统计功能

### 调试技巧

1. **查看控制台** - 面板会在控制台输出调试信息
2. **检查状态** - 在设置标签页查看控制器状态
3. **监控统计** - 使用统计标签页分析使用模式
4. **清空重试** - 遇到问题时可以清空记录重新开始

## 扩展功能

### 自定义样式
```tsx
// 自定义面板样式
<EnhancedDebugPanel 
  style={{ 
    top: 50, 
    right: 50,
    width: 500 
  }} 
/>
```

### 自定义配置
```tsx
// 通过Hook自定义配置
const { updateConfig } = useVirtualHumanController(viewer);

updateConfig({
  enableSmartSegmentation: true,
  enableSeamlessTransition: true
});
```

这个调试面板为虚拟人控制系统提供了强大的监控和调试能力，帮助开发者更好地理解和优化虚拟人的行为。 